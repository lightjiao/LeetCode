/**
给定一个只包含 '(' 和 ')' 的字符串，找出最长的包含有效括号的子串的长度。

示例 1:

输入: "(()"
输出: 2
解释: 最长有效括号子串为 "()"
示例 2:

输入: ")()())"
输出: 4
解释: 最长有效括号子串为 "()()"
 */
#define CATCH_CONFIG_MAIN  // This tells Catch to provide a main() - only do
                           // this in one cpp file
#include "../catch.hpp"

#include "limits.h"
#include <algorithm>
#include <iostream>
#include <numeric>
#include <string>
#include <vector>

using namespace std;

class Solution
{
public:
    /**
     * 动态规划
     */
    int longestValidParentheses(string str)
    {
        if (str.size() == 0) {
            return 0;
        }

        // 计算以 i 结尾的最长有效括号子串
        vector<int> dp((int)str.size(), 0);

        int result = dp[0];
        for (int i = 1; i < str.size(); i++) {
            if (str[i] == '(') {
                continue;
            }

            stack<char> sta;

            int len = 0, j = i;
            // 以 i结尾所以从i开始倒序遍历
            while (j >= 0) {
                if (false == sta.empty() && sta.top() == ')' && str[j] == '(') {
                    sta.pop();
                }
                else {
                    sta.push(str[j]);
                }

                if (sta.empty()) {
                    len = i - j + 1;
                }

                j--;
                if (j == i - 1) {
                    j -= dp[i - 1];
                }
            }

            dp[i] = len;

            result = max(result, dp[i]);
        }

        return result;
    }
};

TEST_CASE("test")
{
    Solution s;
    REQUIRE(s.longestValidParentheses("(()") == 2);
    REQUIRE(s.longestValidParentheses(")()())") == 4);
    REQUIRE(s.longestValidParentheses("(())") == 4);
    REQUIRE(s.longestValidParentheses(
                "(()()(()(()))()((()))((()(()())()(()))())))()(()()))())))))))("
                ")()()()))(((()())((()()(((())))()(()()(())((()))))))(()(()))(("
                "(()())()))(()))((((()(()()()())()()(()))(()()(())()((()()())))"
                "(())()())()(") == 68);
    REQUIRE(
        s.longestValidParentheses(
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((("
            "(((((((((((((((((((((((((((((((((()())))(())()())((((()())((())))("
            "(()))()())))()(()()()(()((()))()()()))()()()(()()((((())()(((()((("
            "())((()))()((()(()))()())))))))))())()())(()()))((()()()()())))((("
            ")()((((()()))))(())())()()))))(())()(()))((((((()))(()()()()(())(("
            ")((()))(()(())(((()()))(()((((()((((()((((())(())))()(())))()))(()"
            "((((((((())()()((())((()())()))))())())()(((((()()(((((())()((()(("
            "(()))(()(()))(()(()())))())(()((((()((()(((((()()))((()(()((())())"
            ")))(()(()())((()((()((((())))(()())()))()())())()))))(())))(())()("
            "(())(()(()))))()())(((()(()(((((((((()(()()())))((()((()())())())("
            "((((()(()))))()))()))))()())()(()(())))(()))))(()))(((()))))()))))"
            ")(((())((())((((()((()))((())))()))(((()))())()))()()()((()()(()()"
            ")(()))()()((()())))))())(()())(((())))))())(())()))()())())(()(()("
            "(())((()(()((())(()()()(()((()(((()(())()(((())))))()())))))(()((("
            "(()(()()))(((())(()))(()()))))(())()((()))()))()()))()((())(()())("
            "))())(()))(()()(())()(()((((()())(((())(()()())())(()()))())))(()("
            "(())(()()))))(()))((()()((((()())(()()))()())()())))()(()((((())()"
            ")()(())()))()()(()(()))))))(((()()((()))(()((((()()((())))())())))"
            "()())))())))((())()()()))()((()((()))()()())))(())())(()(()(()(())"
            ")())()))(())((())()())(((()()(((())(()()))(()())(())))()))(((()()("
            ")())))())))(((()))())())())))(((()))()())())())))))()()()()(())))("
            "()())))(()()())))()((((()()()((((()))()())))(()))()))))(()())()))("
            "((((())()((())()))(()())()()()())()(((()(()(())))))(()(((()()))((("
            "(()()))()))(((())(()(()))()(())))()()(()))))()))))()())))()))((((("
            "(((()()())((()(()()()(((())())())))()()(())(())))()())()())))((())"
            ")((((())()()))(())(((())(()()(((((()()((()()(((()(()()(((())()))))"
            "()(()())(()((((()()())(((()))(())((())()))))())))))(()()()())))())"
            ")(())((()())()())()()))(())))((()))()()((()())()()))(()()(())()())"
            "(())))((()(((())))()))))((((()))((())())())()(())(()))((((((())()("
            ")(((((()))()())(((()(()(())()((()())))(((())(()(())))))(()(()(((()"
            "))(())((((())))((())((((((((()(((((()(())))((((((())(()((((()(())("
            ")()((())())())((((((((()))))(((())()))()()))(())(())()()())(()()(("
            "())(()))())(((())(()((())(())(())))))(()(()(()()(((()()()))())(())"
            ")(())())()(((()((())((()())()(((((()()(()))))(((())()()))(()(()(()"
            "(()((())))))))(())())()))()(()(()))))()()((((())()())(((())(()))(("
            "()())(()((())()()(())((((())))))(())())())(())(()()(()()))(((()((("
            "(())(((())))))(()()()()(((()((((())(()))((())()))()(((((((()(()())"
            "))((()()(()()((())()))()(())))((()()((((()()()))((())()))((())(((("
            ")(()()()(((()((())((())()())())))((()))))))))))(())()()(((()()()))"
            ")(((()))(()))))(((()(()())(()))(())((()))(((()(()()(((((((()())((("
            "(()))((((()(()())())()(((()(()((()))))))))))()()(((()()((((((((((("
            "))))))((((())())((()(((()())()))()()(((((())(()())())(((()((())((("
            "(((())(((())(((()(()(((((((()(())()())(()))))(()(((()))))))()))((("
            "())))(()(()())()))(()()(()(()((()())()(())((()()((()()()(()(()()))"
            "(((((())()(()())()((()())()))(((((()((())()((()((((()(((())())(()("
            ")(())()(())(()(())))))(()())((()((()()()())(()))(()))))))(()((())("
            "())((())()())()()))(()((()))(()()))()())(())(()()(()))((())()((())"
            "((((((())()(()()(((((())(()())())())()()(()())))))()))()((())((((("
            "(()())((()))))))((()(()()(((((((())))))))((()))(())(((()(()(())()("
            ")()()(()(())()))))))())()))()(((((()(())(((()))((()))()))()()(()(("
            ")((())(()))))()())((()())))))))(()()(()()))()((()(())()((())(()())"
            ")())((()())())()()))))((((()()()))())(())()())))()))()))))()))((()"
            "(()())()))()))(((()()()()())))())()))((()()())((()())))(((()((()()"
            "())(())))()(())(()(()(())(()(((((()()()(((())()())(()((()())(()((("
            "()(())((((()())()(())))(((((((()))))())())))(()))()()(((()())(()))"
            "()())(())()))()((())()((())((()((())()())(()()))(((((()()()((((((("
            "(()(()((()()((((((()())))((((((())))())(()(()((((()(()())())()()))"
            "()((())())(()((((()(((()())((())))))(()())(()()()(()))()())()()))("
            "(()((()())(())()()()((())()()))))())()))())))(()))(()))()))((())()"
            "((()((()))))))())(((()))))))()(((()((())))((()())())()))((()(()(()"
            "(()))((()()))())))(()())))())(()))(())(())))))()(())(()()))()))((("
            "))))(()))(()))))(())()())(()(()))())(()(())(())))(()))())(()())))("
            "))(()())((()))()()((()(()()()(((((()((()((())(()())(())))()))))))("
            "((())())))()((((()))()((()))())()))()))(()(()((()()())()()(((()))("
            "))))))()((((()()))))()))())))()())))(((((()(())))())(((()))((()))("
            "((()(())())()((()(((()))()())))))((((()))()(()((((((()(()()()())(("
            "))((()))()(()()))))))()(((())))(())()())))))((()))(())()))))(()((("
            "()()((())(()))))(((((()))))())))()(())(()(()))()))()))(()((())(()("
            "(()())()(((()))))())(())()(())))((())(()(((()))(((((()))(()))())))"
            "(()((((((())()((((())())()))((())))))())(()(())())))))()()(((())()"
            "())))))()))()())))()(())())(())()()()(((())))(())(((()))(()(((()()"
            "))())((()))(((()()()()())()()))(()))))()()))))(((()()))))()()(()()"
            "))()()()())())()((())(((()())(((())(()((()(((()(()())()()()(()((()"
            ")(()()(()()()))))))()((()))))()(()))()))(())()()())))()()(((()))(("
            "()()(((()())))((()()())((())))))()())()((())))())(()())()()()()((("
            "))((()()())((()()))())(())())()(()(((()))())(()))))(()()))(())))))"
            "))()())()((()())()()))()())))((()()(()())()(()))((())()))(((())))("
            "))))(((()()())())(") == 2684);
}